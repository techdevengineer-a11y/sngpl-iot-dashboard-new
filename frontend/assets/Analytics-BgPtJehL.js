import{r as o,d as de,g as ue,c as M,z as S,j as t}from"./index-CuPLTIq6.js";import{L as me}from"./Layout-Bhj-hCGg.js";import{r as re,c as ge,b as he,S as pe,u as xe,s as fe,d as ve,e as be,f as ye,g as je,h as we,i as Pe,j as se,k as Se,l as ee,m as De,R as I,A as Ne,C as V,X as W,Y as U,T as $,a as Oe}from"./AreaChart-DqSnVAAS.js";import{S as Ee,B as Ce,a as ke}from"./BarChart-D74YUTXE.js";import{L as Ae,a as A}from"./LineChart-GUh-rr9v.js";import"./string-9MY7XALd.js";function T(){return T=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},T.apply(null,arguments)}function te(e,a){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);a&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,s)}return r}function _e(e){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?te(Object(r),!0).forEach(function(s){Fe(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):te(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function Fe(e,a,r){return(a=Le(a))in e?Object.defineProperty(e,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[a]=r,e}function Le(e){var a=Be(e,"string");return typeof a=="symbol"?a:a+""}function Be(e,a){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(e)}var f=32,ze={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function Re(e){var{data:a,iconType:r,inactiveColor:s}=e,n=f/2,c=f/6,u=f/3,g=a.inactive?s:a.color,d=r??a.type;if(d==="none")return null;if(d==="plainline"){var h;return o.createElement("line",{strokeWidth:4,fill:"none",stroke:g,strokeDasharray:(h=a.payload)===null||h===void 0?void 0:h.strokeDasharray,x1:0,y1:n,x2:f,y2:n,className:"recharts-legend-icon"})}if(d==="line")return o.createElement("path",{strokeWidth:4,fill:"none",stroke:g,d:"M0,".concat(n,"h").concat(u,`
            A`).concat(c,",").concat(c,",0,1,1,").concat(2*u,",").concat(n,`
            H`).concat(f,"M").concat(2*u,",").concat(n,`
            A`).concat(c,",").concat(c,",0,1,1,").concat(u,",").concat(n),className:"recharts-legend-icon"});if(d==="rect")return o.createElement("path",{stroke:"none",fill:g,d:"M0,".concat(f/8,"h").concat(f,"v").concat(f*3/4,"h").concat(-f,"z"),className:"recharts-legend-icon"});if(o.isValidElement(a.legendIcon)){var i=_e({},a);return delete i.legendIcon,o.cloneElement(a.legendIcon,i)}return o.createElement(Ee,{fill:g,cx:n,cy:n,size:f,sizeType:"diameter",type:d})}function Te(e){var{payload:a,iconSize:r,layout:s,formatter:n,inactiveColor:c,iconType:u}=e,g={x:0,y:0,width:f,height:f},d={display:s==="horizontal"?"inline-block":"block",marginRight:10},h={display:"inline-block",verticalAlign:"middle",marginRight:4};return a.map((i,v)=>{var b=i.formatter||n,N=ge({"recharts-legend-item":!0,["legend-item-".concat(v)]:!0,inactive:i.inactive});if(i.type==="none")return null;var p=i.inactive?c:i.color,w=b?b(i.value,i,v):i.value;return o.createElement("li",T({className:N,style:d,key:"legend-item-".concat(v)},he(e,i,v)),o.createElement(pe,{width:r,height:r,viewBox:g,style:h,"aria-label":"".concat(w," legend icon")},o.createElement(Re,{data:i,iconType:u,inactiveColor:c})),o.createElement("span",{className:"recharts-legend-item-text",style:{color:p}},w))})}var He=e=>{var a=re(e,ze),{payload:r,layout:s,align:n}=a;if(!r||!r.length)return null;var c={padding:0,margin:0,textAlign:s==="horizontal"?n:"left"};return o.createElement("ul",{className:"recharts-default-legend",style:c},o.createElement(Te,T({},a,{payload:r})))};function Ke(){return xe(fe)}var Me=["contextPayload"];function q(){return q=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},q.apply(null,arguments)}function ae(e,a){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);a&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,s)}return r}function D(e){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?ae(Object(r),!0).forEach(function(s){Ie(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ae(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function Ie(e,a,r){return(a=Ve(a))in e?Object.defineProperty(e,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[a]=r,e}function Ve(e){var a=We(e,"string");return typeof a=="symbol"?a:a+""}function We(e,a){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(e)}function Ue(e,a){if(e==null)return{};var r,s,n=$e(e,a);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(s=0;s<c.length;s++)r=c[s],a.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function $e(e,a){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(a.indexOf(s)!==-1)continue;r[s]=e[s]}return r}function qe(e){return e.value}function Ge(e){var{contextPayload:a}=e,r=Ue(e,Me),s=De(a,e.payloadUniqBy,qe),n=D(D({},r),{},{payload:s});return o.isValidElement(e.content)?o.cloneElement(e.content,n):typeof e.content=="function"?o.createElement(e.content,n):o.createElement(He,n)}function Xe(e,a,r,s,n,c){var{layout:u,align:g,verticalAlign:d}=a,h,i;return(!e||(e.left===void 0||e.left===null)&&(e.right===void 0||e.right===null))&&(g==="center"&&u==="vertical"?h={left:((s||0)-c.width)/2}:h=g==="right"?{right:r&&r.right||0}:{left:r&&r.left||0}),(!e||(e.top===void 0||e.top===null)&&(e.bottom===void 0||e.bottom===null))&&(d==="middle"?i={top:((n||0)-c.height)/2}:i=d==="bottom"?{bottom:r&&r.bottom||0}:{top:r&&r.top||0}),D(D({},h),i)}function Ye(e){var a=se();return o.useEffect(()=>{a(Se(e))},[a,e]),null}function Ze(e){var a=se();return o.useEffect(()=>(a(ee(e)),()=>{a(ee({width:0,height:0}))}),[a,e]),null}function Je(e,a,r,s){return e==="vertical"&&Pe(a)?{height:a}:e==="horizontal"?{width:r||s}:null}var Qe={align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function R(e){var a=re(e,Qe),r=Ke(),s=ve(),n=be(),{width:c,height:u,wrapperStyle:g,portal:d}=a,[h,i]=ye([r]),v=je(),b=we();if(v==null||b==null)return null;var N=v-((n==null?void 0:n.left)||0)-((n==null?void 0:n.right)||0),p=Je(a.layout,u,c,N),w=d?g:D(D({position:"absolute",width:(p==null?void 0:p.width)||c||"auto",height:(p==null?void 0:p.height)||u||"auto"},Xe(g,a,n,v,b,h)),g),_=d??s;if(_==null||r==null)return null;var O=o.createElement("div",{className:"recharts-legend-wrapper",style:w,ref:i},o.createElement(Ye,{layout:a.layout,align:a.align,verticalAlign:a.verticalAlign,itemSorter:a.itemSorter}),!d&&o.createElement(Ze,{width:h.width,height:h.height}),o.createElement(Ge,q({},a,p,{margin:n,chartWidth:v,chartHeight:b,contextPayload:r})));return de.createPortal(O,_)}R.displayName="Legend";const ot=()=>{var X,Y,Z;const[e,a]=o.useState([]),[r,s]=o.useState("all"),[n,c]=o.useState("temperature"),[u,g]=o.useState("7d"),[d,h]=o.useState(""),[i,v]=o.useState(""),[b,N]=o.useState([]),[p,w]=o.useState(null),[_,O]=o.useState(!1),[H,ne]=o.useState("csv");o.useEffect(()=>{le()},[]),o.useEffect(()=>{e.length>0&&G()},[r,n,u,e]);const le=async()=>{try{const l=await ue();a(l)}catch(l){console.error("Error fetching devices:",l)}},G=async()=>{var l,P,E;O(!0);try{const C=new Date,k=new Date;k.setDate(k.getDate()-7);const y={page:1,page_size:1e3,start_date:k.toISOString(),end_date:C.toISOString()};r!=="all"&&(y.device_id=r);const m=await M.get("/analytics/readings",{params:y}),et=((l=m.data)==null?void 0:l.total)||0,J=((P=m.data)==null?void 0:P.total_pages)||1;let K=Array.isArray((E=m.data)==null?void 0:E.data)?m.data.data:[];if(J>1){const x=Math.min(J-1,9),B=[];for(let j=2;j<=x+1;j++)B.push(M.get("/analytics/readings",{params:{...y,page:j}}));(await Promise.all(B)).forEach(j=>{var Q;Array.isArray((Q=j.data)==null?void 0:Q.data)&&(K=K.concat(j.data.data))})}const L=K,ce=L.map(x=>({time:new Date(x.timestamp).toLocaleString(),timestamp:x.timestamp,temperature:x.temperature||0,static_pressure:x.static_pressure||0,differential_pressure:x.differential_pressure||0,volume:x.volume||0,total_volume_flow:x.total_volume_flow||0,device:x.client_id||"Unknown"}));if(N(ce),L.length>0){const x=L.map(z=>z[n]||0),B={min:Math.min(...x).toFixed(2),max:Math.max(...x).toFixed(2),avg:(x.reduce((z,j)=>z+j,0)/x.length).toFixed(2),count:L.length};w(B)}else w(null);O(!1)}catch(C){console.error("Error fetching analytics data:",C),S.error("Failed to fetch analytics data"),O(!1)}},oe=async()=>{try{S.loading("Exporting data...");let l,P;if(u==="custom"&&d&&i)l=d,P=i;else{P=new Date().toISOString();const m=new Date;switch(u){case"1h":m.setHours(m.getHours()-1);break;case"24h":m.setHours(m.getHours()-24);break;case"7d":m.setDate(m.getDate()-7);break;case"30d":m.setDate(m.getDate()-30);break;default:m.setHours(m.getHours()-24)}l=m.toISOString()}const E={start_date:l,end_date:P,format:H};r!=="all"&&(E.device_id=r);const C=await M.get("/analytics/export",{params:E,responseType:"blob"}),k=window.URL.createObjectURL(new Blob([C.data])),y=document.createElement("a");y.href=k,y.setAttribute("download",`analytics_${Date.now()}.${H}`),document.body.appendChild(y),y.click(),y.remove(),S.dismiss(),S.success("Data exported successfully!")}catch(l){S.dismiss(),console.error("Error exporting data:",l),S.error("Failed to export data")}},F=[{value:"temperature",label:"Temperature (Â°C)"},{value:"static_pressure",label:"Static Pressure"},{value:"differential_pressure",label:"Differential Pressure"},{value:"volume",label:"Volume (MCF)"},{value:"total_volume_flow",label:"Total Volume Flow (MCF/day)"}],ie=[{value:"1h",label:"Last Hour"},{value:"24h",label:"Last 24 Hours"},{value:"7d",label:"Last 7 Days"},{value:"30d",label:"Last 30 Days"},{value:"custom",label:"Custom Range"}];return t.jsx(me,{children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-white",children:"Analytics"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Historical data analysis and insights"})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("select",{value:H,onChange:l=>ne(l.target.value),className:"px-4 py-2 bg-gray-800/50 text-white rounded-lg border border-gray-700 focus:outline-none focus:border-blue-500",children:[t.jsx("option",{value:"csv",children:"CSV"}),t.jsx("option",{value:"xlsx",children:"Excel"})]}),t.jsxs("button",{onClick:oe,className:"px-4 py-2 bg-green-600/20 hover:bg-green-600/30 text-green-400 rounded-lg transition-all duration-200 flex items-center space-x-2",children:[t.jsx("span",{children:"ðŸ“¥"}),t.jsx("span",{children:"Export Data"})]})]})]}),t.jsxs("div",{className:"glass rounded-xl p-6",children:[t.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Filters"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Device"}),t.jsxs("select",{value:r,onChange:l=>s(l.target.value),className:"w-full px-4 py-2 bg-gray-800/50 text-white rounded-lg border border-gray-700 focus:outline-none focus:border-blue-500",children:[t.jsx("option",{value:"all",children:"All Devices"}),e.map(l=>t.jsxs("option",{value:l.id,children:[l.device_name," (",l.client_id,")"]},l.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Parameter"}),t.jsx("select",{value:n,onChange:l=>c(l.target.value),className:"w-full px-4 py-2 bg-gray-800/50 text-white rounded-lg border border-gray-700 focus:outline-none focus:border-blue-500",children:F.map(l=>t.jsx("option",{value:l.value,children:l.label},l.value))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Time Range"}),t.jsx("select",{value:u,onChange:l=>g(l.target.value),className:"w-full px-4 py-2 bg-gray-800/50 text-white rounded-lg border border-gray-700 focus:outline-none focus:border-blue-500",children:ie.map(l=>t.jsx("option",{value:l.value,children:l.label},l.value))})]}),t.jsx("div",{className:"flex items-end",children:t.jsx("button",{onClick:G,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all duration-200",children:"Apply Filters"})})]}),u==="custom"&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Start Date"}),t.jsx("input",{type:"datetime-local",value:d,onChange:l=>h(l.target.value),className:"w-full px-4 py-2 bg-gray-800/50 text-white rounded-lg border border-gray-700 focus:outline-none focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"End Date"}),t.jsx("input",{type:"datetime-local",value:i,onChange:l=>v(l.target.value),className:"w-full px-4 py-2 bg-gray-800/50 text-white rounded-lg border border-gray-700 focus:outline-none focus:border-blue-500"})]})]})]}),p&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[t.jsxs("div",{className:"glass rounded-xl p-6",children:[t.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"Minimum Value"}),t.jsx("p",{className:"text-3xl font-bold text-blue-400",children:p.min})]}),t.jsxs("div",{className:"glass rounded-xl p-6",children:[t.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"Maximum Value"}),t.jsx("p",{className:"text-3xl font-bold text-red-400",children:p.max})]}),t.jsxs("div",{className:"glass rounded-xl p-6",children:[t.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"Average Value"}),t.jsx("p",{className:"text-3xl font-bold text-green-400",children:p.avg})]}),t.jsxs("div",{className:"glass rounded-xl p-6",children:[t.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"Data Points"}),t.jsx("p",{className:"text-3xl font-bold text-purple-400",children:p.count})]})]}),_?t.jsxs("div",{className:"glass rounded-xl p-12 text-center",children:[t.jsx("div",{className:"text-4xl mb-4",children:"â³"}),t.jsx("p",{className:"text-gray-400",children:"Loading analytics data..."})]}):b.length===0?t.jsxs("div",{className:"glass rounded-xl p-12 text-center",children:[t.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“ˆ"}),t.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Data Available"}),t.jsx("p",{className:"text-gray-400",children:"Select different filters or wait for devices to send data"}),t.jsxs("p",{className:"text-sm text-gray-500 mt-4",children:[e.length," device(s) configured"]})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"glass rounded-xl p-6",children:[t.jsxs("h2",{className:"text-xl font-semibold text-white mb-4",children:[(X=F.find(l=>l.value===n))==null?void 0:X.label," Trend"]}),t.jsx(I,{width:"100%",height:400,children:t.jsxs(Ne,{data:b,children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"colorParam",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#3B82F6",stopOpacity:.8}),t.jsx("stop",{offset:"95%",stopColor:"#3B82F6",stopOpacity:0})]})}),t.jsx(V,{strokeDasharray:"3 3",stroke:"#374151"}),t.jsx(W,{dataKey:"time",stroke:"#9CA3AF"}),t.jsx(U,{stroke:"#9CA3AF"}),t.jsx($,{contentStyle:{backgroundColor:"#1F2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#9CA3AF"}}),t.jsx(R,{}),t.jsx(Oe,{type:"monotone",dataKey:n,stroke:"#3B82F6",fillOpacity:1,fill:"url(#colorParam)",name:(Y=F.find(l=>l.value===n))==null?void 0:Y.label})]})})]}),r==="all"&&t.jsxs("div",{className:"glass rounded-xl p-6",children:[t.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Device Comparison"}),t.jsx(I,{width:"100%",height:300,children:t.jsxs(Ce,{data:b.slice(-20),children:[t.jsx(V,{strokeDasharray:"3 3",stroke:"#374151"}),t.jsx(W,{dataKey:"device",stroke:"#9CA3AF"}),t.jsx(U,{stroke:"#9CA3AF"}),t.jsx($,{contentStyle:{backgroundColor:"#1F2937",border:"none",borderRadius:"8px"}}),t.jsx(R,{}),t.jsx(ke,{dataKey:n,fill:"#10B981",name:(Z=F.find(l=>l.value===n))==null?void 0:Z.label})]})})]}),t.jsxs("div",{className:"glass rounded-xl p-6",children:[t.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"All Parameters Overview"}),t.jsx(I,{width:"100%",height:400,children:t.jsxs(Ae,{data:b.slice(-50),children:[t.jsx(V,{strokeDasharray:"3 3",stroke:"#374151"}),t.jsx(W,{dataKey:"time",stroke:"#9CA3AF"}),t.jsx(U,{stroke:"#9CA3AF"}),t.jsx($,{contentStyle:{backgroundColor:"#1F2937",border:"none",borderRadius:"8px"}}),t.jsx(R,{}),t.jsx(A,{type:"monotone",dataKey:"temperature",stroke:"#F59E0B",name:"Temperature"}),t.jsx(A,{type:"monotone",dataKey:"static_pressure",stroke:"#10B981",name:"Static Pressure"}),t.jsx(A,{type:"monotone",dataKey:"differential_pressure",stroke:"#3B82F6",name:"Diff. Pressure"}),t.jsx(A,{type:"monotone",dataKey:"volume",stroke:"#8B5CF6",name:"Volume (MCF)"}),t.jsx(A,{type:"monotone",dataKey:"total_volume_flow",stroke:"#EC4899",name:"Total Flow (MCF/day)"})]})})]})]})]})})};export{ot as default};
