import{r as c,g as P,c as g,z as d,j as e}from"./index-CuPLTIq6.js";import{L as M}from"./Layout-Bhj-hCGg.js";const U=()=>{const[W,k]=c.useState([]),[j,C]=c.useState([]),[_,N]=c.useState(!0),[F,h]=c.useState(!1),[$,w]=c.useState(!1),[o,L]=c.useState(null),[b,f]=c.useState([]),[E,D]=c.useState(!1),[r,p]=c.useState({startDate:"",endDate:"",limit:100,quickFilter:"7days"}),[n,m]=c.useState({client_id:"",device_name:"",device_type:"EVC",location:"",latitude:0,longitude:0});c.useEffect(()=>{y();const t=setInterval(y,1e4);return()=>clearInterval(t)},[]);const y=async()=>{try{const t=await P();console.log("Fetched devices:",t),k(t);const a=(await Promise.all(t.map(async s=>{try{const i=await g.get(`/analytics/device/${s.id}/recent?limit=1`),x=i.data&&i.data.length>0?i.data[0]:null;return{...s,latestReading:x}}catch{return{...s,latestReading:null}}}))).sort((s,i)=>s.is_active!==i.is_active?i.is_active?1:-1:(s.client_id||"").localeCompare(i.client_id||""));C(a),N(!1)}catch(t){console.error("Error fetching devices:",t),d.error("Failed to load devices"),N(!1)}},T=async t=>{t.preventDefault();try{await g.post("/devices/",n),d.success("Device added successfully!"),h(!1),m({client_id:"",device_name:"",location:"",latitude:0,longitude:0}),y()}catch(l){d.error("Failed to add device"),console.error("Error adding device:",l)}},q=async t=>{if(window.confirm("Are you sure you want to delete this device?"))try{await g.delete(`/devices/${t}`),d.success("Device deleted successfully!"),y()}catch(l){d.error("Failed to delete device"),console.error("Error deleting device:",l)}},A=t=>{L(t),w(!0);const l=new Date,a=new Date;a.setDate(a.getDate()-7),p({startDate:a.toISOString().split("T")[0],endDate:l.toISOString().split("T")[0],limit:100,quickFilter:"7days"}),v(t.client_id,{startDate:a.toISOString().split("T")[0],endDate:l.toISOString().split("T")[0],limit:100})},u=t=>{const l=new Date;let a=new Date;switch(t){case"today":a.setHours(0,0,0,0);break;case"1day":a.setDate(a.getDate()-1);break;case"3days":a.setDate(a.getDate()-3);break;case"7days":a.setDate(a.getDate()-7);break;case"all":a=null;break;default:return}const s={...r,startDate:a?a.toISOString().split("T")[0]:"",endDate:l.toISOString().split("T")[0],quickFilter:t};p(s),o&&v(o.client_id,s)},v=async(t,l)=>{var a;D(!0),f([]);try{const s=new URLSearchParams;s.append("client_id",t),l.startDate&&s.append("start_date",l.startDate+"T00:00:00"),l.endDate&&s.append("end_date",l.endDate+"T23:59:59"),s.append("page_size",l.limit||100),s.append("page",1),console.log("Fetching history with params:",s.toString());const i=await g.get(`/analytics/readings?${s.toString()}`);console.log("History response:",i.data);const x=i.data.data||i.data;f(Array.isArray(x)?x:[]),x.length===0&&d("No data found for the selected time range",{icon:"â„¹ï¸"})}catch(s){d.error("Failed to load history data"),console.error("Error fetching history:",s),console.error("Error response:",(a=s.response)==null?void 0:a.data),f([])}finally{D(!1)}},V=()=>{o&&v(o.client_id,r)},I=async()=>{try{const t=new URLSearchParams;o&&t.append("device_id",o.id),r.startDate&&t.append("start_date",r.startDate),r.endDate&&t.append("end_date",r.endDate);const l=await g.get(`/analytics/readings/export/csv?${t.toString()}`,{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([l.data])),s=document.createElement("a");s.href=a,s.setAttribute("download",`device_${o.client_id}_history.csv`),document.body.appendChild(s),s.click(),s.remove(),d.success("CSV exported successfully!")}catch(t){d.error("Failed to export CSV"),console.error("Error exporting CSV:",t)}},H=t=>{if(!t.last_seen)return"offline";const l=new Date(t.last_seen),s=(new Date-l)/1e3/60;return s<5?"online":s<30?"warning":"offline"},R=t=>!t||t===0?"text-gray-500":t<10?"text-red-600":t<10.5?"text-red-400":t<=14?"text-green-400":"text-yellow-400",O=t=>{const l={online:{color:"bg-green-500",text:"Online",icon:"âœ“"},warning:{color:"bg-yellow-500",text:"Warning",icon:"âš "},offline:{color:"bg-red-500",text:"Offline",icon:"âœ•"}},a=l[t]||l.offline;return e.jsxs("span",{className:`inline-flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-medium ${a.color}/20 text-white`,children:[e.jsx("span",{children:a.icon}),e.jsx("span",{children:a.text})]})};return e.jsxs(M,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Devices"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Real-time device monitoring and parameters"})]}),e.jsxs("button",{onClick:()=>h(!0),className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all duration-200 flex items-center space-x-2 font-medium hover:scale-105 hover:shadow-lg hover:shadow-blue-500/50 active:scale-95",children:[e.jsx("span",{className:"text-xl",children:"âž•"}),e.jsx("span",{children:"Add Device"})]})]}),_?e.jsx("div",{className:"glass rounded-xl p-12 text-center animate-fade-in",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"relative w-16 h-16",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-blue-500/30 rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-4 border-transparent border-t-blue-500 rounded-full animate-spin"})]}),e.jsx("div",{className:"text-gray-400 animate-pulse",children:"Loading devices..."})]})}):j.length===0?e.jsxs("div",{className:"glass rounded-xl p-12 text-center animate-fade-in",children:[e.jsx("div",{className:"text-6xl mb-4 animate-bounce",children:"ðŸ“¡"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Devices Yet"}),e.jsx("p",{className:"text-gray-400",children:"Devices will appear here once they start sending data via MQTT"}),e.jsx("button",{onClick:()=>h(!0),className:"mt-4 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all duration-200",children:"Add Your First Device"})]}):e.jsx("div",{className:"glass rounded-xl overflow-hidden animate-fade-in",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-800/50 border-b border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-400 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-400 uppercase",children:"Device Name"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-400 uppercase",children:"Client ID"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-400 uppercase",children:"Location"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-400 uppercase",children:"Temperature (Â°F)"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-400 uppercase",children:"Static Pressure (PSI)"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-400 uppercase",children:"Diff. Pressure (IWC)"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-400 uppercase",children:"Battery (V)"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-400 uppercase",children:"Volume (MCF)"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-400 uppercase",children:"Total volume flow (MCF/DAY)"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-400 uppercase",children:"Last Seen"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-400 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800",children:j.map((t,l)=>{const a=H(t),s=t.latestReading;return e.jsxs("tr",{className:"hover:bg-gray-800/30 transition-all duration-300 hover:scale-[1.01] animate-fade-in",style:{animationDelay:`${l*.1}s`},children:[e.jsx("td",{className:"px-6 py-4",children:O(a)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${a==="online"?"bg-green-500 animate-pulse":a==="warning"?"bg-yellow-500":"bg-red-500"}`}),e.jsx("span",{className:"text-white font-medium",children:t.device_name})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"font-mono text-sm text-gray-300",children:t.client_id})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-white",children:t.location})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-lg font-semibold ${s?"text-blue-400":"text-gray-500"}`,children:s?s.temperature.toFixed(2):"--"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-lg font-semibold ${s?"text-green-400":"text-gray-500"}`,children:s?s.static_pressure.toFixed(2):"--"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-lg font-semibold ${s?"text-yellow-400":"text-gray-500"}`,children:s?s.differential_pressure.toFixed(2):"--"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-lg font-semibold ${R(s==null?void 0:s.battery)}`,children:s!=null&&s.battery?`${s.battery.toFixed(2)}V`:"--"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-lg font-semibold ${s?"text-purple-400":"text-gray-500"}`,children:s?s.volume.toFixed(2):"--"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-lg font-semibold ${s?"text-pink-400":"text-gray-500"}`,children:s?s.total_volume_flow.toFixed(2):"--"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-gray-400 text-sm",children:t.last_seen?new Date(t.last_seen).toLocaleString():"Never"})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{onClick:()=>A(t),className:"px-3 py-1 bg-blue-600/20 hover:bg-blue-600/30 text-blue-400 rounded transition-all duration-200 text-sm hover:scale-105 active:scale-95",children:"History"}),e.jsx("button",{onClick:()=>q(t.client_id),className:"px-3 py-1 bg-red-600/20 hover:bg-red-600/30 text-red-400 rounded transition-all duration-200 text-sm hover:scale-105 active:scale-95",children:"Delete"})]})})]},t.id)})})]})})})]}),F&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-gray-900 rounded-2xl p-8 max-w-md w-full border border-gray-700 animate-scale-in",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Add New Device"}),e.jsx("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-white text-2xl",children:"âœ•"})]}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Device ID"}),e.jsx("input",{type:"text",value:n.client_id,onChange:t=>m({...n,client_id:t.target.value}),className:"w-full px-4 py-2 bg-gray-800/50 text-white rounded-lg border border-gray-700 focus:outline-none focus:border-blue-500",placeholder:"e.g., modem2",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Device Name"}),e.jsx("input",{type:"text",value:n.device_name,onChange:t=>m({...n,device_name:t.target.value}),className:"w-full px-4 py-2 bg-gray-800/50 text-white rounded-lg border border-gray-700 focus:outline-none focus:border-blue-500",placeholder:"e.g., Compressor Station 2",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Device Type"}),e.jsxs("select",{value:n.device_type,onChange:t=>m({...n,device_type:t.target.value}),className:"w-full px-4 py-2 bg-gray-800/50 text-white rounded-lg border border-gray-700 focus:outline-none focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"EVC",children:"EVC (Electronic Volume Corrector)"}),e.jsx("option",{value:"FC",children:"FC (Flow Computer)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Location"}),e.jsx("input",{type:"text",value:n.location,onChange:t=>m({...n,location:t.target.value}),className:"w-full px-4 py-2 bg-gray-800/50 text-white rounded-lg border border-gray-700 focus:outline-none focus:border-blue-500",placeholder:"e.g., Lahore, Pakistan",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Latitude"}),e.jsx("input",{type:"number",step:"any",value:n.latitude,onChange:t=>m({...n,latitude:parseFloat(t.target.value)}),className:"w-full px-4 py-2 bg-gray-800/50 text-white rounded-lg border border-gray-700 focus:outline-none focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Longitude"}),e.jsx("input",{type:"number",step:"any",value:n.longitude,onChange:t=>m({...n,longitude:parseFloat(t.target.value)}),className:"w-full px-4 py-2 bg-gray-800/50 text-white rounded-lg border border-gray-700 focus:outline-none focus:border-blue-500"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>h(!1),className:"px-6 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-all duration-200 hover:scale-105 active:scale-95",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all duration-200 hover:scale-105 hover:shadow-lg hover:shadow-blue-500/50 active:scale-95",children:"Add Device"})]})]})]})}),$&&o&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-gray-900 rounded-2xl p-8 max-w-6xl w-full border border-gray-700 max-h-[90vh] overflow-y-auto animate-scale-in",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Data History"}),e.jsxs("p",{className:"text-gray-400 mt-1",children:[o.device_name," (",o.client_id,")"]})]}),e.jsx("button",{onClick:()=>w(!1),className:"text-gray-400 hover:text-white text-2xl",children:"âœ•"})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Quick Filters"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>u("today"),className:`px-4 py-2 rounded-lg transition-all duration-200 hover:scale-105 active:scale-95 ${r.quickFilter==="today"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Today"}),e.jsx("button",{onClick:()=>u("1day"),className:`px-4 py-2 rounded-lg transition-all duration-200 hover:scale-105 active:scale-95 ${r.quickFilter==="1day"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"1 Day"}),e.jsx("button",{onClick:()=>u("3days"),className:`px-4 py-2 rounded-lg transition-all duration-200 hover:scale-105 active:scale-95 ${r.quickFilter==="3days"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"3 Days"}),e.jsx("button",{onClick:()=>u("7days"),className:`px-4 py-2 rounded-lg transition-all duration-200 hover:scale-105 active:scale-95 ${r.quickFilter==="7days"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"7 Days"}),e.jsx("button",{onClick:()=>u("all"),className:`px-4 py-2 rounded-lg transition-all duration-200 hover:scale-105 active:scale-95 ${r.quickFilter==="all"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"All Data"}),e.jsx("button",{onClick:()=>u("custom"),className:`px-4 py-2 rounded-lg transition-all duration-200 hover:scale-105 active:scale-95 ${r.quickFilter==="custom"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Custom Range"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Start Date"}),e.jsx("input",{type:"date",value:r.startDate,onChange:t=>{p({...r,startDate:t.target.value,quickFilter:"custom"})},className:"w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-700 focus:outline-none focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"End Date"}),e.jsx("input",{type:"date",value:r.endDate,onChange:t=>{p({...r,endDate:t.target.value,quickFilter:"custom"})},className:"w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-700 focus:outline-none focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Limit"}),e.jsxs("select",{value:r.limit,onChange:t=>p({...r,limit:parseInt(t.target.value)}),className:"w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-700 focus:outline-none focus:border-blue-500",children:[e.jsx("option",{value:50,children:"50 records"}),e.jsx("option",{value:100,children:"100 records"}),e.jsx("option",{value:500,children:"500 records"}),e.jsx("option",{value:1e3,children:"1000 records"})]})]}),e.jsxs("div",{className:"flex items-end space-x-2",children:[e.jsx("button",{onClick:V,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all duration-200 hover:scale-105 hover:shadow-lg hover:shadow-blue-500/50 active:scale-95",children:"ðŸ” Search"}),e.jsx("button",{onClick:I,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-all duration-200 hover:scale-105 hover:shadow-lg hover:shadow-green-500/50 active:scale-95",children:"ðŸ“¥ Export CSV"})]})]})]}),E?e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"relative w-16 h-16",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-blue-500/30 rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-4 border-transparent border-t-blue-500 rounded-full animate-spin"})]}),e.jsx("div",{className:"text-gray-400 animate-pulse",children:"Loading history data..."})]})}):b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“Š"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Data Found"}),e.jsx("p",{className:"text-gray-400",children:"Try adjusting your search filters"})]}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-800/50 border-b border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-400",children:"Timestamp"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-400",children:"Temp (Â°C)"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-400",children:"Static P. (bar)"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-400",children:"Diff P. (bar)"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-400",children:"Volume (mÂ³)"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-400",children:"Flow (mÂ³/h)"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800",children:b.map((t,l)=>{var a,s,i,x,S;return e.jsxs("tr",{className:"hover:bg-gray-800/30 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-300",children:new Date(t.timestamp).toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-sm text-blue-400 font-semibold",children:((a=t.temperature)==null?void 0:a.toFixed(2))||"--"}),e.jsx("td",{className:"px-4 py-3 text-sm text-green-400 font-semibold",children:((s=t.static_pressure)==null?void 0:s.toFixed(2))||"--"}),e.jsx("td",{className:"px-4 py-3 text-sm text-yellow-400 font-semibold",children:((i=t.differential_pressure)==null?void 0:i.toFixed(2))||"--"}),e.jsx("td",{className:"px-4 py-3 text-sm text-purple-400 font-semibold",children:((x=t.volume)==null?void 0:x.toFixed(2))||"--"}),e.jsx("td",{className:"px-4 py-3 text-sm text-pink-400 font-semibold",children:((S=t.total_volume_flow)==null?void 0:S.toFixed(2))||"--"})]},t.id||l)})})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-400 text-center",children:["Showing ",b.length," records"]})]})]})})]})};export{U as default};
