import{u as I,r,A as m,j as e}from"./index-CuPLTIq6.js";const u="http://localhost:8000/api",V=()=>{const{token:d,user:v}=I(),[S,U]=r.useState([]),[A,y]=r.useState(!0),[$,p]=r.useState(!1),[P,g]=r.useState(!1),[o,N]=r.useState("create"),[_,C]=r.useState(null),[w,D]=r.useState(""),[b,L]=r.useState("all"),[h,M]=r.useState("all"),[t,c]=r.useState({username:"",email:"",password:"",full_name:"",role:"user",is_active:!0}),[l,x]=r.useState({current_password:"",new_password:"",confirm_password:""});r.useEffect(()=>{j()},[]);const j=async()=>{try{const s=await m.get(`${u}/users/`,{headers:{Authorization:`Bearer ${d}`}});U(s.data),y(!1)}catch(s){console.error("Error fetching users:",s),y(!1)}},E=()=>{N("create"),c({username:"",email:"",password:"",full_name:"",role:"user",is_active:!0}),p(!0)},F=s=>{N("edit"),C(s),c({username:s.username,email:s.email,full_name:s.full_name||"",role:s.role,is_active:s.is_active}),p(!0)},R=async(s,a)=>{var n,i;if(window.confirm(`Are you sure you want to delete user "${a}"?`))try{await m.delete(`${u}/users/${s}`,{headers:{Authorization:`Bearer ${d}`}}),j()}catch(f){alert(((i=(n=f.response)==null?void 0:n.data)==null?void 0:i.detail)||"Failed to delete user")}},q=async s=>{var a,n;s.preventDefault();try{if(o==="create")await m.post(`${u}/users/`,t,{headers:{Authorization:`Bearer ${d}`}});else{const i={email:t.email,full_name:t.full_name,role:t.role,is_active:t.is_active};await m.put(`${u}/users/${_.id}`,i,{headers:{Authorization:`Bearer ${d}`}})}p(!1),j()}catch(i){alert(((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.detail)||"Operation failed")}},z=async s=>{var a,n;if(s.preventDefault(),l.new_password!==l.confirm_password){alert("New passwords do not match");return}try{await m.post(`${u}/users/${_.id}/change-password`,{current_password:l.current_password,new_password:l.new_password},{headers:{Authorization:`Bearer ${d}`}}),alert("Password changed successfully"),g(!1),x({current_password:"",new_password:"",confirm_password:""})}catch(i){alert(((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.detail)||"Failed to change password")}},k=S.filter(s=>{var f;const a=s.username.toLowerCase().includes(w.toLowerCase())||((f=s.email)==null?void 0:f.toLowerCase().includes(w.toLowerCase())),n=b==="all"||s.role===b,i=h==="all"||h==="active"&&s.is_active||h==="inactive"&&!s.is_active;return a&&n&&i}),B=s=>{const a={admin:"bg-red-100 text-red-800 border-red-200",user:"bg-blue-100 text-blue-800 border-blue-200",viewer:"bg-gray-100 text-gray-800 border-gray-200"};return a[s]||a.user};return A?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"User Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage system users and permissions"})]}),e.jsx("div",{className:"enterprise-card p-6 mb-6",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 flex-1",children:[e.jsx("input",{type:"text",placeholder:"Search users...",value:w,onChange:s=>D(s.target.value),className:"enterprise-input max-w-xs"}),e.jsxs("select",{value:b,onChange:s=>L(s.target.value),className:"enterprise-input max-w-xs",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"viewer",children:"Viewer"})]}),e.jsxs("select",{value:h,onChange:s=>M(s.target.value),className:"enterprise-input max-w-xs",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsx("button",{onClick:E,className:"enterprise-button",children:"+ Create User"})]})}),e.jsxs("div",{className:"enterprise-card overflow-hidden",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:k.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:s.username.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.username}),e.jsx("div",{className:"text-sm text-gray-500",children:s.full_name||"No name set"})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:s.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full border ${B(s.role)}`,children:s.role.toUpperCase()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.is_active?e.jsx("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 border border-green-200",children:"Active"}):e.jsx("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800 border border-gray-200",children:"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>F(s),className:"text-blue-600 hover:text-blue-900 font-semibold",children:"Edit"}),s.id===v.id&&e.jsx("button",{onClick:()=>{C(s),g(!0)},className:"text-indigo-600 hover:text-indigo-900 font-semibold",children:"Change Password"}),s.id!==v.id&&e.jsx("button",{onClick:()=>R(s.id,s.username),className:"text-red-600 hover:text-red-900 font-semibold",children:"Delete"})]})})]},s.id))})]}),k.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No users found"})})]}),$&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"enterprise-card p-8 max-w-md w-full mx-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:o==="create"?"Create New User":"Edit User"}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Username"}),e.jsx("input",{type:"text",value:t.username,onChange:s=>c({...t,username:s.target.value}),className:"enterprise-input",required:!0,disabled:o==="edit"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:t.email,onChange:s=>c({...t,email:s.target.value}),className:"enterprise-input",required:!0})]}),o==="create"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Password"}),e.jsx("input",{type:"password",value:t.password,onChange:s=>c({...t,password:s.target.value}),className:"enterprise-input",required:!0,minLength:8})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:t.full_name,onChange:s=>c({...t,full_name:s.target.value}),className:"enterprise-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Role"}),e.jsxs("select",{value:t.role,onChange:s=>c({...t,role:s.target.value}),className:"enterprise-input",required:!0,children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"viewer",children:"Viewer"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.is_active,onChange:s=>c({...t,is_active:s.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:"Active"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",className:"enterprise-button flex-1",children:o==="create"?"Create User":"Update User"}),e.jsx("button",{type:"button",onClick:()=>p(!1),className:"enterprise-button-secondary flex-1",children:"Cancel"})]})]})]})}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"enterprise-card p-8 max-w-md w-full mx-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Change Password"}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Current Password"}),e.jsx("input",{type:"password",value:l.current_password,onChange:s=>x({...l,current_password:s.target.value}),className:"enterprise-input",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"New Password"}),e.jsx("input",{type:"password",value:l.new_password,onChange:s=>x({...l,new_password:s.target.value}),className:"enterprise-input",required:!0,minLength:8})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Confirm New Password"}),e.jsx("input",{type:"password",value:l.confirm_password,onChange:s=>x({...l,confirm_password:s.target.value}),className:"enterprise-input",required:!0,minLength:8})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",className:"enterprise-button flex-1",children:"Change Password"}),e.jsx("button",{type:"button",onClick:()=>{g(!1),x({current_password:"",new_password:"",confirm_password:""})},className:"enterprise-button-secondary flex-1",children:"Cancel"})]})]})]})})]})};export{V as default};
