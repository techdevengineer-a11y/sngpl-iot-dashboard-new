import{r as i,h as z,i as B,j as e,t as G,z as r,k as I,l as O,m as U}from"./index-CuPLTIq6.js";import{L as w}from"./Layout-Bhj-hCGg.js";import{B as A}from"./bell-BjJmD8pt.js";import{c as S}from"./createLucideIcon-Bp_Bh7vc.js";import{T as _}from"./trash-2-BF0OiL1R.js";import{G as V}from"./gauge-C3G_6xek.js";import{W as R}from"./wifi-off-C9qm20-S.js";import{A as q}from"./alert-triangle-CENt64Gl.js";import{A as J}from"./activity-DvS__W_y.js";import{C as K,a as Q}from"./chevron-up-D-Km4I2m.js";import{C as x}from"./check-circle-vKC8st0W.js";import{C as X}from"./clock-CARLuty7.js";/**
 * @license lucide-react v0.307.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=S("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.307.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=S("StopCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{width:"6",height:"6",x:"9",y:"9",key:"1wrtvo"}]]),me=()=>{const[m,k]=i.useState([]),[g,C]=i.useState([]),[D,h]=i.useState(!0),[p,y]=i.useState(!0),[u,b]=i.useState(null);i.useEffect(()=>{n(),j();const t=setInterval(()=>{n(),j()},3e4);return()=>clearInterval(t)},[]);const n=async()=>{try{const l=await(await fetch("/api/alarms/by-section")).json();k(l.sections||[]);const a=await z({limit:1e3});C(a),h(!1)}catch(t){console.error("Error fetching alarm data:",t),h(!1)}},j=async()=>{try{const t=await B();y(t.enabled)}catch(t){console.error("Error fetching monitoring status:",t)}},L=async t=>{try{await O(t),r.success("Alarm acknowledged successfully"),n()}catch{r.error("Failed to acknowledge alarm")}},M=async t=>{if(window.confirm("Are you sure you want to delete this alarm?"))try{await U(t),r.success("Alarm deleted successfully"),n()}catch{r.error("Failed to delete alarm")}},$=async()=>{if(window.confirm("Are you sure you want to delete ALL alarms? This action cannot be undone."))try{const t=await I();r.success(t.message||"All alarms deleted successfully"),n()}catch{r.error("Failed to delete all alarms")}},E=async()=>{try{const t=await G();y(t.enabled),t.enabled?r.success("Alarm monitoring started"):r.success("Alarm monitoring stopped")}catch{r.error("Failed to toggle alarm monitoring")}},F=t=>{b(u===t?null:t)},T=t=>t==="high"?{bg:"bg-red-500/10",border:"border-red-500/30",text:"text-red-600",icon:"text-red-500",bgSolid:"bg-red-100"}:t==="medium"?{bg:"bg-yellow-500/10",border:"border-yellow-500/30",text:"text-yellow-600",icon:"text-yellow-500",bgSolid:"bg-yellow-100"}:{bg:"bg-blue-500/10",border:"border-blue-500/30",text:"text-blue-600",icon:"text-blue-500",bgSolid:"bg-blue-100"},f=["from-blue-600 to-blue-700","from-green-600 to-green-700","from-purple-600 to-purple-700","from-orange-600 to-orange-700","from-pink-600 to-pink-700"],P=t=>f[t%f.length],W=t=>g.filter(l=>{var a;return(a=l.client_id)==null?void 0:a.startsWith(`SMS-${t}-`)});return D?e.jsx(w,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-4 text-gray-400",children:"Loading alarm data..."})]})}):e.jsx(w,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"glass rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(A,{className:"w-8 h-8"}),"Alarm Monitoring System"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:E,className:`px-5 py-2.5 rounded-lg transition-all duration-200 font-semibold hover:scale-105 flex items-center gap-2 ${p?"bg-orange-600 hover:bg-orange-700 text-white":"bg-green-600 hover:bg-green-700 text-white"}`,children:p?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4"}),"Stop Monitoring"]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4"}),"Start Monitoring"]})}),g.length>0&&e.jsxs("button",{onClick:$,className:"px-5 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-all duration-200 font-semibold hover:scale-105 flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),"Delete All Alarms"]})]})]})}),m.length===0?e.jsxs("div",{className:"glass rounded-xl p-12 text-center",children:[e.jsx(A,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Section Data Available"}),e.jsx("p",{className:"text-gray-600",children:"Waiting for section data to load..."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map((t,l)=>{const a=W(t.section_id),H=t.total_devices-t.active_devices,c=u===t.section_id;return e.jsxs("div",{className:"glass rounded-xl p-6 transition-all duration-300",children:[e.jsxs("div",{onClick:()=>F(t.section_id),className:"cursor-pointer hover:scale-105 transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`w-16 h-16 bg-gradient-to-br ${P(l)} rounded-xl flex items-center justify-center text-white shadow-lg`,children:e.jsx("span",{className:"text-2xl font-bold",children:t.section_id})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Active Alarms"}),e.jsx("div",{className:`text-3xl font-bold ${t.active_alarms>0?"text-red-600":"text-green-600"}`,children:t.active_alarms}),e.jsxs("div",{className:"text-xs text-gray-600",children:[t.high_severity_alarms>0&&`${t.high_severity_alarms} High`,t.high_severity_alarms>0&&t.medium_severity_alarms>0&&" | ",t.medium_severity_alarms>0&&`${t.medium_severity_alarms} Med`]})]})]}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:t.section_name}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-blue-100 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(V,{className:"w-4 h-4 text-blue-600"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:t.total_devices})]}),e.jsxs("div",{className:"bg-red-100 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(R,{className:"w-4 h-4 text-red-600"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Offline"})]}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:H})]}),e.jsxs("div",{className:"bg-red-100 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(q,{className:"w-4 h-4 text-red-600"}),e.jsx("div",{className:"text-xs text-gray-600",children:"High"})]}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:t.high_severity_alarms})]}),e.jsxs("div",{className:"bg-yellow-100 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(J,{className:"w-4 h-4 text-yellow-600"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Medium"})]}),e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:t.medium_severity_alarms})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-300",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[a.length," alarm",a.length!==1?"s":""]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:c?"Hide Details":"View Details"}),c?e.jsx(K,{className:"w-5 h-5 text-gray-600"}):e.jsx(Q,{className:"w-5 h-5 text-gray-600"})]})]})]}),c&&e.jsx("div",{className:"mt-4 border-t border-gray-300 pt-4 animate-in slide-in-from-top duration-300",children:a.length===0?e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[e.jsx(x,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-semibold text-green-600",children:"All Clear"}),e.jsx("p",{className:"text-xs text-gray-600",children:"No active alarms"})]}):e.jsx("div",{className:"max-h-96 overflow-y-auto border border-gray-200 rounded-lg",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-100 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left text-gray-700 font-semibold",children:"Device"}),e.jsx("th",{className:"px-2 py-2 text-left text-gray-700 font-semibold",children:"Parameter"}),e.jsx("th",{className:"px-2 py-2 text-left text-gray-700 font-semibold",children:"Value"}),e.jsx("th",{className:"px-2 py-2 text-left text-gray-700 font-semibold",children:"Severity"}),e.jsx("th",{className:"px-2 py-2 text-left text-gray-700 font-semibold",children:"Time"}),e.jsx("th",{className:"px-2 py-2 text-center text-gray-700 font-semibold",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(s=>{var N,v;const o=T(s.severity);return e.jsxs("tr",{className:`hover:bg-gray-50 ${s.is_acknowledged?"opacity-60":""}`,children:[e.jsx("td",{className:"px-2 py-3 whitespace-nowrap",children:e.jsx("span",{className:"font-medium text-gray-900",children:s.client_id||"Unknown"})}),e.jsx("td",{className:"px-2 py-3 whitespace-nowrap",children:e.jsx("span",{className:"text-gray-700",children:(N=s.parameter)==null?void 0:N.replace(/_/g," ")})}),e.jsx("td",{className:"px-2 py-3 whitespace-nowrap",children:e.jsx("span",{className:`font-bold ${o.text}`,children:(v=s.value)==null?void 0:v.toFixed(2)})}),e.jsxs("td",{className:"px-2 py-3 whitespace-nowrap",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold uppercase ${o.bgSolid} ${o.text}`,children:s.severity}),s.is_acknowledged&&e.jsx(x,{className:"w-3 h-3 text-green-600 inline ml-1"})]}),e.jsxs("td",{className:"px-2 py-3 whitespace-nowrap text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"w-3 h-3"}),new Date(s.triggered_at).toLocaleTimeString()]}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(s.triggered_at).toLocaleDateString()})]}),e.jsx("td",{className:"px-2 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[!s.is_acknowledged&&e.jsx("button",{onClick:d=>{d.stopPropagation(),L(s.id)},className:"p-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded transition-all",title:"Acknowledge",children:e.jsx(x,{className:"w-3 h-3"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),M(s.id)},className:"p-1.5 bg-red-600 hover:bg-red-700 text-white rounded transition-all",title:"Delete",children:e.jsx(_,{className:"w-3 h-3"})})]})})]},s.id)})})]})})})]},t.section_id)})}),e.jsxs("div",{className:"text-center text-sm text-gray-500",children:["Last updated: ",new Date().toLocaleString()]})]})})};export{me as default};
