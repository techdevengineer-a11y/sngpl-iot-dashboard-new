import{r as l,g as L,c as R,j as e}from"./index-CuPLTIq6.js";import{L as C}from"./Layout-Bhj-hCGg.js";const k=()=>{const[n,N]=l.useState([]),[x,b]=l.useState({}),[r,i]=l.useState([]),[M,o]=l.useState(!0),[y,v]=l.useState(new Date);l.useEffect(()=>{w()},[]),l.useEffect(()=>{n.length>0&&i(n.map(t=>t.id))},[n]),l.useEffect(()=>{if(r.length>0){m();const t=setInterval(m,1e4);return()=>clearInterval(t)}},[r]);const w=async()=>{try{const t=await L();N(t),o(!1)}catch(t){console.error("Error fetching devices:",t),o(!1)}},m=async()=>{try{const t={};await Promise.all(r.map(async a=>{try{const s=await R.get(`/analytics/device/${a}/recent?limit=1`);s.data&&s.data.length>0&&(t[a]=s.data[0])}catch(s){console.error(`Error fetching data for device ${a}:`,s)}})),b(t),v(new Date)}catch(t){console.error("Error fetching live data:",t)}},_=t=>{r.includes(t)?i(r.filter(a=>a!==t)):i([...r,t])},D=()=>{i(n.map(t=>t.id))},S=()=>{i([])},c=(t,a)=>{switch(a){case"temperature":return t>100||t<20?"text-red-400":t>90||t<30?"text-yellow-400":"text-green-400";case"static_pressure":return t<30||t>120?"text-red-400":t<40||t>110?"text-yellow-400":"text-green-400";case"differential_pressure":return t>300?"text-red-400":t>250?"text-yellow-400":"text-green-400";case"volume":return t<3e3?"text-red-400":t<4e3?"text-yellow-400":"text-green-400";case"total_volume_flow":return t<5e3?"text-red-400":t<8e3?"text-yellow-400":"text-green-400";default:return"text-blue-400"}},g=t=>{if(!t.last_seen)return"offline";const a=new Date(t.last_seen),d=(new Date-a)/1e3;return d<10?"online":d<60?"warning":"offline"};return e.jsx(C,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Live Monitoring"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Real-time device data with 2-second refresh"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Last Update: ",y.toLocaleTimeString()]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500 animate-pulse"}),e.jsx("span",{className:"text-sm text-green-400",children:"Live"})]})]})]}),e.jsxs("div",{className:"glass rounded-xl p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Select Devices to Monitor"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:D,className:"px-4 py-2 bg-blue-600/20 hover:bg-blue-600/30 text-blue-400 rounded-lg transition-all duration-200 text-sm",children:"Select All"}),e.jsx("button",{onClick:S,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-all duration-200 text-sm",children:"Deselect All"})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:n.map(t=>{const a=g(t);return e.jsxs("button",{onClick:()=>_(t.id),className:`p-3 rounded-lg border-2 transition-all duration-200 ${r.includes(t.id)?"border-blue-500 bg-blue-600/20":"border-gray-700 bg-gray-800/50 hover:border-gray-600"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${a==="online"?"bg-green-500 animate-pulse":a==="warning"?"bg-yellow-500":"bg-red-500"}`}),r.includes(t.id)&&e.jsx("div",{className:"text-blue-400",children:"âœ“"})]}),e.jsx("p",{className:"text-white font-medium text-sm truncate",children:t.device_name}),e.jsx("p",{className:"text-gray-400 text-xs truncate",children:t.client_id})]},t.id)})})]}),r.length===0?e.jsxs("div",{className:"glass rounded-xl p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“Š"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Devices Selected"}),e.jsx("p",{className:"text-gray-400",children:"Select devices above to start monitoring live data"})]}):e.jsx("div",{className:"space-y-4",children:r.map(t=>{var h,u,j,f,p;const a=n.find(F=>F.id===t),s=x[t],d=g(a);return e.jsxs("div",{className:"glass rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full ${d==="online"?"bg-green-500 animate-pulse":d==="warning"?"bg-yellow-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:a.device_name}),e.jsxs("p",{className:"text-sm text-gray-400",children:[a.client_id," â€¢ ",a.location]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Last Reading"}),e.jsx("p",{className:"text-white font-medium",children:s?new Date(s.timestamp).toLocaleTimeString():"No data"})]})]}),s?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-lg border-l-4 border-orange-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400 text-sm font-medium",children:"Temperature"}),e.jsx("span",{className:"text-2xl",children:"ðŸŒ¡ï¸"})]}),e.jsx("p",{className:`text-3xl font-bold ${c(s.temperature,"temperature")}`,children:((h=s.temperature)==null?void 0:h.toFixed(1))||"0.0"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Â°F"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Range: -10 to 150Â°F"})]}),e.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-lg border-l-4 border-blue-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400 text-sm font-medium",children:"Static Pressure"}),e.jsx("span",{className:"text-2xl",children:"ðŸ“Š"})]}),e.jsx("p",{className:`text-3xl font-bold ${c(s.static_pressure,"static_pressure")}`,children:((u=s.static_pressure)==null?void 0:u.toFixed(1))||"0.0"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"PSI"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Range: 0 to 150 PSI"})]}),e.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-lg border-l-4 border-yellow-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400 text-sm font-medium",children:"Diff. Pressure"}),e.jsx("span",{className:"text-2xl",children:"âš¡"})]}),e.jsx("p",{className:`text-3xl font-bold ${c(s.differential_pressure,"differential_pressure")}`,children:((j=s.differential_pressure)==null?void 0:j.toFixed(1))||"0.0"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"IWC"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Range: 0 to 500 IWC"})]}),e.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-lg border-l-4 border-purple-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400 text-sm font-medium",children:"Volume"}),e.jsx("span",{className:"text-2xl",children:"ðŸ“¦"})]}),e.jsx("p",{className:`text-3xl font-bold ${c(s.volume,"volume")}`,children:((f=s.volume)==null?void 0:f.toFixed(1))||"0.0"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"MCF"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Range: 0 to 25000 MCF"})]}),e.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-lg border-l-4 border-cyan-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400 text-sm font-medium",children:"Total Flow"}),e.jsx("span",{className:"text-2xl",children:"ðŸ’§"})]}),e.jsx("p",{className:`text-3xl font-bold ${c(s.total_volume_flow,"total_volume_flow")}`,children:((p=s.total_volume_flow)==null?void 0:p.toFixed(1))||"0.0"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"MCF/day"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Range: 0 to 40000 MCF/day"})]})]}):e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("p",{children:"No recent data available for this device"})})]},t)})}),r.length>0&&e.jsxs("div",{className:"glass rounded-xl p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Monitoring Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Devices Monitored"}),e.jsx("p",{className:"text-3xl font-bold text-blue-400",children:r.length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Active Readings"}),e.jsx("p",{className:"text-3xl font-bold text-green-400",children:Object.keys(x).length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Update Interval"}),e.jsx("p",{className:"text-3xl font-bold text-purple-400",children:"2s"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Data Quality"}),e.jsxs("p",{className:"text-3xl font-bold text-green-400",children:[r.length>0?Math.round(Object.keys(x).length/r.length*100):0,"%"]})]})]})]})]})})};export{k as default};
