import{r as d,h as z,g as E,j as e,c as D,z as j}from"./index-CuPLTIq6.js";import{L as T}from"./Layout-Bhj-hCGg.js";const U=()=>{const[i,$]=d.useState([]),[f,o]=d.useState([]),[r,m]=d.useState("all"),[_,N]=d.useState(!0),[t,C]=d.useState(null),[A,p]=d.useState(!1);d.useEffect(()=>{h();const s=setInterval(h,6e4);return()=>clearInterval(s)},[]),d.useEffect(()=>{R()},[i,r]);const h=async()=>{try{const[s,l]=await Promise.all([z({limit:100}),E()]),u=s.map(a=>({id:`alarm-${a.id}`,type:"alarm",severity:a.severity,title:`${a.severity.toUpperCase()} Alarm: ${a.parameter}`,message:`Device ${a.client_id} ${a.parameter} is ${a.value}`,timestamp:a.triggered_at,isRead:a.is_acknowledged,data:a})),n=[];l.forEach(a=>{const c=S(a);(c==="offline"||c==="warning")&&n.push({id:`device-${a.id}`,type:"device_status",severity:c==="offline"?"critical":"warning",title:`Device ${c==="offline"?"Offline":"Connection Warning"}`,message:`${a.device_name} (${a.client_id}) is ${c}`,timestamp:a.last_seen||new Date().toISOString(),isRead:!1,data:a})});const g=[...u,...n].sort((a,c)=>new Date(c.timestamp)-new Date(a.timestamp));$(g),N(!1)}catch(s){console.error("Error fetching notifications:",s),N(!1)}},S=s=>{if(!s.last_seen)return"offline";const l=new Date(s.last_seen),n=(new Date-l)/1e3/60;return n<5?"online":n<30?"warning":"offline"},R=()=>{r==="all"?o(i):r==="unread"?o(i.filter(s=>!s.isRead)):r==="alarm"?o(i.filter(s=>s.type==="alarm")):r==="device_status"?o(i.filter(s=>s.type==="device_status")):r==="critical"&&o(i.filter(s=>s.severity==="critical"))},y=async s=>{if(s.type==="alarm"&&!s.isRead)try{await D.put(`/alarms/${s.data.id}/acknowledge`),j.success("Alarm acknowledged"),h()}catch{j.error("Failed to acknowledge alarm")}},v=async()=>{try{const s=i.filter(l=>l.type==="alarm"&&!l.isRead);await Promise.all(s.map(l=>D.put(`/alarms/${l.data.id}/acknowledge`))),j.success("All alarms acknowledged"),h()}catch{j.error("Failed to acknowledge all alarms")}},L=()=>{window.confirm("Are you sure you want to clear all notifications? This will acknowledge all alarms.")&&v()},M=s=>{C(s),p(!0),s.isRead||y(s)},b=(s,l)=>s==="alarm"?l==="critical"?"ðŸš¨":l==="warning"?"âš ï¸":"â„¹ï¸":"ðŸ“¡",w=s=>{const l={critical:"bg-red-600/20 border-red-600/50 text-red-400",warning:"bg-yellow-600/20 border-yellow-600/50 text-yellow-400",info:"bg-blue-600/20 border-blue-600/50 text-blue-400",online:"bg-green-600/20 border-green-600/50 text-green-400"};return l[s]||l.info},k=s=>{const l=new Date,u=new Date(s),n=l-u,g=Math.floor(n/6e4),a=Math.floor(n/36e5),c=Math.floor(n/864e5);return g<1?"Just now":g<60?`${g}m ago`:a<24?`${a}h ago`:`${c}d ago`},x={total:i.length,unread:i.filter(s=>!s.isRead).length,critical:i.filter(s=>s.severity==="critical").length,alarms:i.filter(s=>s.type==="alarm").length};return e.jsxs(T,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Notifications Center"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Real-time system alerts and notifications"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:h,className:"px-4 py-2 bg-blue-600/20 hover:bg-blue-600/30 text-blue-400 rounded-lg transition-all duration-200 flex items-center space-x-2",children:[e.jsx("span",{children:"ðŸ”„"}),e.jsx("span",{children:"Refresh"})]}),e.jsxs("button",{onClick:v,className:"px-4 py-2 bg-green-600/20 hover:bg-green-600/30 text-green-400 rounded-lg transition-all duration-200 flex items-center space-x-2",children:[e.jsx("span",{children:"âœ“"}),e.jsx("span",{children:"Mark All Read"})]}),e.jsxs("button",{onClick:L,className:"px-4 py-2 bg-red-600/20 hover:bg-red-600/30 text-red-400 rounded-lg transition-all duration-200 flex items-center space-x-2",children:[e.jsx("span",{children:"ðŸ—‘ï¸"}),e.jsx("span",{children:"Clear All"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"glass rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Total Notifications"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-1",children:x.total})]}),e.jsx("div",{className:"text-4xl",children:"ðŸ“¬"})]})}),e.jsx("div",{className:"glass rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Unread"}),e.jsx("p",{className:"text-3xl font-bold text-blue-400 mt-1",children:x.unread})]}),e.jsx("div",{className:"text-4xl",children:"ðŸ“¨"})]})}),e.jsx("div",{className:"glass rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Critical Alerts"}),e.jsx("p",{className:"text-3xl font-bold text-red-400 mt-1",children:x.critical})]}),e.jsx("div",{className:"text-4xl",children:"ðŸš¨"})]})}),e.jsx("div",{className:"glass rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Alarms"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-400 mt-1",children:x.alarms})]}),e.jsx("div",{className:"text-4xl",children:"ðŸ””"})]})})]}),e.jsx("div",{className:"glass rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center space-x-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>m("all"),className:`px-4 py-2 rounded-lg transition-all duration-200 whitespace-nowrap ${r==="all"?"bg-blue-600 text-white":"bg-gray-800/50 text-gray-400 hover:bg-gray-800"}`,children:["All (",i.length,")"]}),e.jsxs("button",{onClick:()=>m("unread"),className:`px-4 py-2 rounded-lg transition-all duration-200 whitespace-nowrap ${r==="unread"?"bg-blue-600 text-white":"bg-gray-800/50 text-gray-400 hover:bg-gray-800"}`,children:["Unread (",x.unread,")"]}),e.jsxs("button",{onClick:()=>m("critical"),className:`px-4 py-2 rounded-lg transition-all duration-200 whitespace-nowrap ${r==="critical"?"bg-blue-600 text-white":"bg-gray-800/50 text-gray-400 hover:bg-gray-800"}`,children:["Critical (",x.critical,")"]}),e.jsxs("button",{onClick:()=>m("alarm"),className:`px-4 py-2 rounded-lg transition-all duration-200 whitespace-nowrap ${r==="alarm"?"bg-blue-600 text-white":"bg-gray-800/50 text-gray-400 hover:bg-gray-800"}`,children:["Alarms (",x.alarms,")"]}),e.jsxs("button",{onClick:()=>m("device_status"),className:`px-4 py-2 rounded-lg transition-all duration-200 whitespace-nowrap ${r==="device_status"?"bg-blue-600 text-white":"bg-gray-800/50 text-gray-400 hover:bg-gray-800"}`,children:["Device Status (",i.filter(s=>s.type==="device_status").length,")"]})]})}),e.jsx("div",{className:"space-y-3",children:_?e.jsx("div",{className:"glass rounded-xl p-12 text-center",children:e.jsx("div",{className:"text-gray-400",children:"Loading notifications..."})}):f.length===0?e.jsxs("div",{className:"glass rounded-xl p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“­"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Notifications"}),e.jsx("p",{className:"text-gray-400",children:"You're all caught up! No notifications to show."})]}):f.map(s=>e.jsx("div",{onClick:()=>M(s),className:`glass rounded-xl p-6 cursor-pointer transition-all duration-200 hover:scale-[1.01] border-2 ${w(s.severity)} ${s.isRead?"":"border-l-4"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[e.jsx("div",{className:"text-4xl",children:b(s.type,s.severity)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:s.title}),!s.isRead&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500 animate-pulse"})]}),e.jsx("p",{className:"text-gray-300 mb-2",children:s.message}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-400",children:[e.jsx("span",{children:k(s.timestamp)}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"capitalize",children:s.type.replace("_"," ")}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"capitalize",children:s.severity})]})]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(s.timestamp).toLocaleString()})]})},s.id))})]}),A&&t&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 rounded-2xl p-8 max-w-2xl w-full border border-gray-700 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-5xl",children:b(t.type,t.severity)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:t.title}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:new Date(t.timestamp).toLocaleString()})]})]}),e.jsx("button",{onClick:()=>p(!1),className:"text-gray-400 hover:text-white text-2xl",children:"âœ•"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:`p-4 rounded-lg border-2 ${w(t.severity)}`,children:e.jsx("p",{className:"text-white text-lg",children:t.message})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-lg",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Type"}),e.jsx("p",{className:"text-white font-semibold capitalize",children:t.type.replace("_"," ")})]}),e.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-lg",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Severity"}),e.jsx("p",{className:"text-white font-semibold capitalize",children:t.severity})]}),e.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-lg",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Time"}),e.jsx("p",{className:"text-white font-semibold",children:k(t.timestamp)})]}),e.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-lg",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Status"}),e.jsx("p",{className:"text-white font-semibold",children:t.isRead?"Read":"Unread"})]})]}),t.type==="alarm"&&e.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-lg",children:[e.jsx("h3",{className:"text-white font-semibold mb-3",children:"Alarm Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400",children:"Device"}),e.jsx("p",{className:"text-white",children:t.data.client_id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400",children:"Parameter"}),e.jsx("p",{className:"text-white capitalize",children:t.data.parameter})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400",children:"Value"}),e.jsx("p",{className:"text-white",children:t.data.value})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400",children:"Threshold"}),e.jsx("p",{className:"text-white",children:t.data.threshold})]})]})]}),t.type==="device_status"&&e.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-lg",children:[e.jsx("h3",{className:"text-white font-semibold mb-3",children:"Device Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400",children:"Device Name"}),e.jsx("p",{className:"text-white",children:t.data.device_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400",children:"Client ID"}),e.jsx("p",{className:"text-white",children:t.data.client_id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400",children:"Location"}),e.jsx("p",{className:"text-white",children:t.data.location})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400",children:"Last Seen"}),e.jsx("p",{className:"text-white",children:t.data.last_seen?new Date(t.data.last_seen).toLocaleString():"Never"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>p(!1),className:"px-6 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-all duration-200",children:"Close"}),t.type==="alarm"&&!t.isRead&&e.jsx("button",{onClick:()=>{y(t),p(!1)},className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all duration-200",children:"Acknowledge Alarm"})]})]})})]})};export{U as default};
