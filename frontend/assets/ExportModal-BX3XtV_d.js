import{r as i,j as e}from"./index-CuPLTIq6.js";import{D as N}from"./download-BIeXtM7T.js";import{X as L}from"./x-BHP2hNWw.js";import{C as T}from"./calendar-BHWY2O9g.js";import{F as D}from"./file-spreadsheet-BNFMNFvj.js";import{D as V}from"./database-Cj7RBCxv.js";const q=({isOpen:E,onClose:x,deviceId:g,deviceName:C,sectionId:u,exportType:l})=>{const[c,I]=i.useState("7days"),[b,$]=i.useState(""),[p,k]=i.useState(new Date().toISOString().slice(0,16)),[r,f]=i.useState("csv"),[a,y]=i.useState(!1),[j,d]=i.useState(0);if(!E)return null;const R=()=>{const t=new Date,n=t.toISOString();let s;switch(c){case"7days":s=new Date(t.getTime()-7*24*60*60*1e3).toISOString();break;case"15days":s=new Date(t.getTime()-15*24*60*60*1e3).toISOString();break;case"30days":s=new Date(t.getTime()-30*24*60*60*1e3).toISOString();break;case"custom":return s=new Date(b).toISOString(),{start:s,end:new Date(p).toISOString()};default:s=new Date(t.getTime()-7*24*60*60*1e3).toISOString()}return{start:s,end:n}},F=async()=>{y(!0),d(0);try{const{start:t,end:n}=R();let s="";l==="device"&&g?s=`/api/export/device/${g}?start=${encodeURIComponent(t)}&end=${encodeURIComponent(n)}&format=${r}`:l==="section"&&u?s=`/api/export/section/${u}?start=${encodeURIComponent(t)}&end=${encodeURIComponent(n)}&format=${r}`:l==="all"&&(s=`/api/export/all?start=${encodeURIComponent(t)}&end=${encodeURIComponent(n)}&format=${r}`);const M=setInterval(()=>{d(m=>Math.min(m+10,90))},200),h=await fetch(s);if(!h.ok)throw new Error("Export failed");const v=h.headers.get("Content-Disposition");let w=`export_${new Date().toISOString().slice(0,10)}.${r==="csv"?"csv":"xlsx"}`;if(v){const m=v.match(/filename="?(.+)"?/);m&&(w=m[1])}const P=await h.blob(),S=window.URL.createObjectURL(P),o=document.createElement("a");o.href=S,o.download=w,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(S),clearInterval(M),d(100),setTimeout(()=>{x(),d(0)},1e3)}catch(t){console.error("Export error:",t),alert("Failed to export data. Please try again.")}finally{y(!1)}},O=()=>l==="device"?`Export Data: ${C||g}`:l==="section"?`Export Section ${u} Data`:"Export All Devices Data (400 SMS Devices)",U=()=>l==="device"?"Export historical readings for this device":l==="section"?"Export historical readings for all devices in this section":"Export historical readings for all 400 devices across all sections (I-V)";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:O()}),e.jsx("p",{className:"text-blue-100 text-sm mt-1",children:U()})]})]}),e.jsx("button",{onClick:x,disabled:a,className:"text-white hover:bg-white/20 rounded-lg p-2 transition-colors disabled:opacity-50",children:e.jsx(L,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-blue-600"}),"Select Time Range"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{value:"7days",label:"Last 7 Days"},{value:"15days",label:"Last 15 Days"},{value:"30days",label:"Last 30 Days"},{value:"custom",label:"Custom Range"}].map(t=>e.jsx("button",{onClick:()=>I(t.value),disabled:a,className:`px-4 py-3 rounded-lg font-medium transition-all ${c===t.value?"bg-blue-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"} disabled:opacity-50`,children:t.label},t.value))})]}),c==="custom"&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date & Time"}),e.jsx("input",{type:"datetime-local",value:b,onChange:t=>$(t.target.value),disabled:a,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date & Time"}),e.jsx("input",{type:"datetime-local",value:p,onChange:t=>k(t.target.value),disabled:a,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-green-600"}),"Export Format"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>f("csv"),disabled:a,className:`px-4 py-3 rounded-lg font-medium transition-all flex items-center justify-center gap-2 ${r==="csv"?"bg-green-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"} disabled:opacity-50`,children:[e.jsx(D,{className:"w-5 h-5"}),"CSV File"]}),e.jsxs("button",{onClick:()=>f("excel"),disabled:a,className:`px-4 py-3 rounded-lg font-medium transition-all flex items-center justify-center gap-2 ${r==="excel"?"bg-green-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"} disabled:opacity-50`,children:[e.jsx(V,{className:"w-5 h-5"}),"Excel File"]})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Exported Data Includes:"}),e.jsxs("ul",{className:"text-sm text-gray-700 space-y-1",children:[e.jsx("li",{children:"• Temperature (°F)"}),e.jsx("li",{children:"• Static Pressure (PSI)"}),e.jsx("li",{children:"• Max Static Pressure (PSI)"}),e.jsx("li",{children:"• Min Static Pressure (PSI)"}),e.jsx("li",{children:"• Differential Pressure (IWC)"}),e.jsx("li",{children:"• Volume (MCF)"}),e.jsx("li",{children:"• Volume (MMCF)"}),e.jsx("li",{children:"• Total Volume Flow (MCF/day)"}),e.jsx("li",{children:"• Battery Voltage (V)"}),e.jsx("li",{children:"• Timestamps for all readings"})]})]}),a&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Exporting data..."}),e.jsxs("span",{children:[j,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-cyan-600 h-full transition-all duration-300 rounded-full",style:{width:`${j}%`}})})]})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 rounded-b-xl flex items-center justify-between",children:[e.jsx("button",{onClick:x,disabled:a,className:"px-6 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors font-medium disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{onClick:F,disabled:a||c==="custom"&&!b,className:"px-8 py-3 bg-gradient-to-r from-blue-600 to-cyan-600 text-white rounded-lg hover:shadow-lg transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5"}),a?"Exporting...":"Export Data"]})]})]})})};export{q as E};
